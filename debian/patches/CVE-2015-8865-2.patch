From 5272184a1ed0c5c6144e80bed6fb1951601ec3bc Mon Sep 17 00:00:00 2001
From: Anatol Belski <ab@php.net>
Date: Mon, 28 Mar 2016 00:45:19 +0200
Subject: [PATCH] Fixed bug #71527 Buffer over-write in finfo_open with
 malformed magic file

The actual fix is applying the upstream patch from
https://github.com/file/file/commit/6713ca45e7757297381f4b4cdb9cf5e624a9ad36
---
 ext/fileinfo/tests/bug68996.phpt | 9 +++------
 1 file changed, 3 insertions(+), 6 deletions(-)

diff --git a/ext/fileinfo/tests/bug68996.phpt b/ext/fileinfo/tests/bug68996.phpt
index 9fa2190..da208d3 100644
--- a/ext/fileinfo/tests/bug68996.phpt
+++ b/ext/fileinfo/tests/bug68996.phpt
@@ -1,14 +1,11 @@
 --TEST--
 Bug #68996 (Invalid free of CG(interned_empty_string))
 --SKIPIF--
-<?php
-if (getenv("USE_ZEND_ALLOC") !== "0") {
-    print "skip Need Zend MM disabled";
-}
-?>
 <?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
 --INI--
 html_errors=1
+--ENV--
+USE_ZEND_ALLOC=0
 --FILE--
 <?php
 finfo_open(FILEINFO_MIME_TYPE, "\xfc\x63");
@@ -19,4 +16,4 @@ finfo_open(FILEINFO_MIME_TYPE, "\xfc\x63");
 <br />
 <b>Warning</b>:  : failed to open stream: No such file or directory in <b>%sbug68996.php</b> on line <b>%d</b><br />
 <br />
-<b>Warning</b>:  finfo_open():  in <b>%sbug68996.php</b> on line <b>%d</b><br />
+<b>Warning</b>:  finfo_open(): Failed to load magic database at '%sï¿½c'. in <b>%sbug68996.php</b> on line <b>%d</b><br />
-- 
2.1.4

