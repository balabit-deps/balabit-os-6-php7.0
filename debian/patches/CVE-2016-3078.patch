From ccc12efa32f855e6057cb9b7e1e45afe08503a00 Mon Sep 17 00:00:00 2001
From: Stanislav Malyshev <stas@php.net>
Date: Tue, 19 Apr 2016 23:49:22 -0700
Subject: [PATCH] Fix bug #71923 - integer overflow in ZipArchive::getFrom*

---
 ext/zip/php_zip.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

Index: php7.0-7.0.4/ext/zip/php_zip.c
===================================================================
--- php7.0-7.0.4.orig/ext/zip/php_zip.c	2016-05-17 13:00:44.389538087 -0400
+++ php7.0-7.0.4/ext/zip/php_zip.c	2016-05-17 13:00:44.385538036 -0400
@@ -1282,7 +1282,7 @@
 	}
 
 	if (zr_rsrc->zf) {
-		buffer = zend_string_alloc(len, 0);
+		buffer = zend_string_safe_alloc(1, len, 0, 0);
 		n = zip_fread(zr_rsrc->zf, ZSTR_VAL(buffer), ZSTR_LEN(buffer));
 		if (n > 0) {
 			ZSTR_VAL(buffer)[n] = '\0';
@@ -2729,7 +2729,7 @@
 		RETURN_FALSE;
 	}
 
-	buffer = zend_string_alloc(len, 0);
+	buffer = zend_string_safe_alloc(1, len, 0, 0);
 	n = zip_fread(zf, ZSTR_VAL(buffer), ZSTR_LEN(buffer));
 	if (n < 1) {
 		zend_string_free(buffer);
