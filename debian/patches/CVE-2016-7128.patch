Description: fix information disclosure via exif_process_IFD_in_TIFF
Bug: https://bugs.php.net/bug.php?id=72627
Origin: backport, http://git.php.net/?p=php-src.git;a=commit;h=24fb60ffe9d23a6af27d96b74a85f6a237bbd14a
Origin: backport, http://git.php.net/?p=php-src.git;a=commit;h=0d13325b660b5ae64267dffcc9a153c7634fdfe2

Index: php7.0-7.0.8/ext/exif/exif.c
===================================================================
--- php7.0-7.0.8.orig/ext/exif/exif.c	2016-10-03 12:51:05.554248174 -0400
+++ php7.0-7.0.8/ext/exif/exif.c	2016-10-03 12:51:30.626529271 -0400
@@ -3747,8 +3747,11 @@
 						fgot = php_stream_read(ImageInfo->infile, ImageInfo->Thumbnail.data, ImageInfo->Thumbnail.size);
 						if (fgot < ImageInfo->Thumbnail.size) {
 							EXIF_ERRLOG_THUMBEOF(ImageInfo)
+							efree(ImageInfo->Thumbnail.data);
+							ImageInfo->Thumbnail.data = NULL;
+						} else {
+							exif_thumbnail_build(ImageInfo);
 						}
-						exif_thumbnail_build(ImageInfo);
 					}
 #ifdef EXIF_DEBUG
 					exif_error_docref(NULL EXIFERR_CC, ImageInfo, E_NOTICE, "Read next IFD (THUMBNAIL) done");
